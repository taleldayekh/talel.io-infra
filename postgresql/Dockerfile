FROM postgres:14.7-alpine

ARG POSTGRES_USER
ARG POSTGRES_PASSWORD
ARG POSTGRES_DB
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG S3_BACKUPS_BUCKET
ARG S3_POSTGRES_BACKUPS_PREFIX

ENV POSTGRES_USER=${POSTGRES_USER}
ENV POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
ENV POSTGRES_DB=${POSTGRES_DB}
ENV AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
ENV AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
ENV S3_BACKUPS_BUCKET=${S3_BACKUPS_BUCKET}
ENV S3_POSTGRES_BACKUPS_PREFIX=${S3_POSTGRES_BACKUPS_PREFIX}

ADD restore_postgre_db.sh /docker-entrypoint-initdb.d/

RUN apk add --no-cache aws-cli

EXPOSE 5234

ENTRYPOINT ["docker-entrypoint.sh"]

CMD ["postgres"]
